# 💡 실시간 고객 분석 및 RAG 기반 지능형 마케팅 시스템

> **"데이터 지연을 제거하고, 머신러닝 기반의 고객 세분화와 자연어 질의 인터페이스를 결합한 실시간 데이터 플랫폼"**

---

### **0. 서비스 개요 (Service Overview)**

**"데이터 발생부터 마케팅 액션까지, 실시간 지능형 루틴"**

본 시스템은 이커머스 환경에서 발생하는 주문 로그를 실시간으로 수집·가공하고, 머신러닝 모델을 통해 고객 등급을 즉각 업데이트합니다.

![실시간 데이터 유입 및 수집](/images/project/5_flow.png)
*(▲ Flask 기반 주문 시뮬레이션 및 실시간 데이터 수집 흐름)*

![RAG 응답 인터페이스](/images/project/5_rag_ex.png)
*(▲ RAG 기반의 자연어 데이터 조회 및 마케팅 인사이트 도출 화면)*

**[핵심 기능 흐름]**
1.  [cite_start]**실시간 수집:** 대규모 구매 로그를 Azure Event Hub로 수집하고 Stream Analytics로 정제합니다. [cite: 788-790, 836]
2.  [cite_start]**지능형 분류:** 수집된 데이터를 바탕으로 RFM 지표를 실시간 계산하고, GMM 모델을 통해 고객 군집을 업데이트합니다. [cite: 80, 247]
3.  [cite_start]**자연어 질의(RAG):** 마케터는 "VIP 고객들의 특징은?"과 같은 자연어 질문으로 실시간 데이터 분석 결과를 즉시 조회할 수 있습니다. [cite: 1148-1152, 1201]

---

### **1. 프로젝트 배경 및 목표**

**[문제 정의]**
[cite_start]기존 배치 처리 시스템은 결과 도출까지 수 시간의 시차가 발생하여, 고객의 구매 결정 시점에 맞춘 즉각적인 마케팅 프로모션이 어렵다는 한계가 있었습니다. [cite: 25, 488]

**[핵심 목표]**
1.  [cite_start]**실시간성 확보:** 데이터 발생부터 분석까지의 지연(Latency)을 최소화하는 파이프라인 구축. [cite: 29, 492]
2.  [cite_start]**정밀한 고객 세분화:** 단순 통계가 아닌 머신러닝(GMM)을 활용한 정교한 고객 군집화. [cite: 247, 368-370]
3.  [cite_start]**데이터 접근성 혁신:** RAG 기술을 도입하여 기술 지식이 없는 사용자도 자연어로 데이터를 탐색할 수 있는 환경 제공. [cite: 1148-1151, 1618]

---

### **2. 시스템 아키텍처 (Architecture)**

![전체 시스템 아키텍처](/images/project/5_arch.png)
[cite_start]*(▲ Azure PaaS 기반의 실시간 데이터 처리 아키텍처)* [cite: 22, 176]

---

### **3. 핵심 구현 내용 (Real-time & RAG)**

[cite_start]저는 프로젝트의 핵심인 **실시간 데이터 처리 로직과 RAG 인터페이스 구현** 전반을 주도했습니다. [cite: 40-44]

#### **(1) 머신러닝 모델 고도화: K-Means에서 GMM으로**
![K-Means 분석 결과](/images/project/5_modeling_kmeans.png)
[cite_start]*(▲ K-Means 알고리즘을 활용한 초기 분석 과정)* [cite: 245, 350-354]

* [cite_start]**초기 시도:** 직관적인 K-Means 모델을 사용했으나, 군집을 구형으로 가정하는 특성상 실제 데이터의 복잡한 타원형 분포를 반영하기 어려웠습니다. [cite: 245, 367]

![GMM 분석 및 지표](/images/project/5_modeling_gmm.png)
[cite_start]*(▲ GMM 도입 후 성능 지표 개선 결과)* [cite: 247, 368]

* [cite_start]**최종 채택:** 비구형 분포와 경계 중첩 문제를 해결하기 위해 **Gaussian Mixture Model(GMM)**을 도입했습니다. [cite: 247, 368-372] [cite_start]확률 기반의 소프트 클러스터링을 통해 경계면에 있는 고객들까지 유연하게 타겟팅할 수 있는 기반을 마련했습니다. [cite: 378, 427]

#### **(2) 이벤트 기반 실시간 등급 갱신 (Azure Functions)**
* [cite_start]**구현:** Cosmos DB의 Change Feed 기능을 활용하여 주문 로그가 적재되는 즉시 Azure Functions가 실행되도록 설계했습니다. [cite: 936-942]
* [cite_start]**로직:** 해당 함수는 고객의 RFM 점수를 재계산하고, GMM 모델 기준에 따라 고객 등급을 실시간으로 업데이트합니다. [cite: 224, 233-240, 935]

#### **(3) RAG(검색 증강 생성) 질의 인터페이스**
![RAG 아키텍처](/images/project/5_rag.png)
[cite_start]*(▲ 실시간 데이터와 LLM을 결합한 RAG 시스템 구조)* [cite: 1148, 1154-1161]

---

### **4. 트러블 슈팅 (Troubleshooting)**

#### **🚨 RAG 검색 정확도 개선: "의도 기반 프롬프트 분기 전략"**

![의도 파악 및 프롬프트 분기 로직](/images/project/5_trouble_code.png)
[cite_start]*(▲ 사용자 질문의 의도를 분석하여 적절한 프롬프트를 선택하는 파이썬 로직)* [cite: 1181, 1639]

**[문제 상황]**
[cite_start]초기 시스템에서 특정 고객이나 등급에 대해 질문할 때, LLM이 다른 그룹의 데이터를 참조하거나 여러 정보가 뒤섞여 답변의 신뢰도가 떨어지는 현상이 발생했습니다. 

**[해결 과정]**
[cite_start]단순 벡터 유사도 검색의 한계를 보완하기 위해, 검색 이전에 질문의 의도를 파악하여 범위를 한정하는 로직을 도입했습니다. [cite: 1179-1180, 1639]
1. [cite_start]**의도 추출(Intent Extraction):** 질문에서 '요약', '등급', '전략', '메시지' 등 키워드를 분석하여 사용자의 질문 목적을 추론합니다. [cite: 1172-1178, 1181-1182]
2. [cite_start]**프롬프트 분기(Prompt Branching):** 추론된 목적에 따라 검색 범위를 물리적으로 제한하거나, 마케팅 전략 수립/메시지 작성 등 특화된 프롬프트를 적용하도록 설계했습니다. [cite: 1183-1194, 1639]

**[결과]**
[cite_start]비교 분석이나 특정 데이터 조회 시 정확히 해당 범위 내의 정보만을 참조하게 되어 답변의 정확도를 획기적으로 향상시켰습니다. [cite: 1195, 1639]